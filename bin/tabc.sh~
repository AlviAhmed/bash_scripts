#!/bin/sh

# Usage:
# tabc.sh <tabbed-id> <command>
# Commands:
#    add <window-id> 	- Add window to tabbed
#    remove <window-id> - Remove window from tabbed
#    list				- List all clients of tabbed

#
# Functions
#

# Get wid of root window
get_root_wid() {
	xwininfo -root | awk '/Window id:/{print $4}'
}

# Get children of tabbed
get_clients() {
	id=$1
	xwininfo -id $id -children | sed -n '/[0-9]\+ \(child\|children\):/,$s/ \+\(0x[0-9a-z]\+\).*/\1/p'
}

# Get class of a wid
get_class() {
	id=$1
	xprop -id $id | sed -n '/WM_CLASS/s/.*, "\(.*\)"/\1/p'
}

#
# Main Program
#
check=$1; 
tabbed=$1; shift 
notify-send "valued of tabbed: $tabbed"
notify-send "1"
if [ "$(get_class $tabbed)" != "tabbed" ]; then
notify-send "2"
	echo "Not an instance of tabbed" 2>&1
notify-send "3"
	tabbed & 
	tabbed=$(xdotool search --class tabbed | tail -n1)
fi 
notify-send "4"
cmd=$1; shift
notify-send "5"

case $cmd in
	add)
notify-send "6"
		wid=$1; shift
notify-send "7"
		xdotool windowreparent $wid $tabbed
notify-send "8"
		;;
	remove)
notify-send "9"
		wid=$1; shift
notify-send "10"
		xdotool windowreparent $wid $(get_root_wid)
notify-send "11"
		;;
	list)
notify-send "12"
		get_clients $tabbed
notify-send "13"
		;;
esac
notify-send "14"
